{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
    <h1 class="mb-4">游닇 Crear Nueva Tarea</h1>
    
    <form method="POST" action="{{ url_for('crear_tarea') }}" class="needs-validation" novalidate enctype="multipart/form-data">
		<input type="hidden" name="csrf_token" value="{{ csrf_token() }}"/>
        <!-- T칤tulo -->
        <div class="mb-3">
            <label class="form-label">T칤tulo*</label>
            <input type="text" class="form-control" name="titulo" required>
            <div class="invalid-feedback">Por favor ingresa un t칤tulo</div>
        </div>
        
        <!-- Descripci칩n -->
        <div class="mb-3">
            <label class="form-label">Descripci칩n*</label>
            <textarea class="form-control" name="descripcion" rows="3" required></textarea>
        </div>
        
        <!-- Prioridad -->
        <div class="mb-3 col-md-3">
            <label class="form-label">Prioridad*</label>
            <select class="form-select" name="prioridad" required>
                <option value="alta">游댮 Alta</option>
                <option value="media" selected>游리 Media</option>
                <option value="baja">游릭 Baja</option>
            </select>
        </div>
        
        <!-- Fecha L칤mite -->
        <div class="mb-3 col-md-3">
            <label class="form-label">Fecha L칤mite*</label>
            <input type="date" class="form-control" name="fecha_limite" 
                   min="{{ now.strftime('%Y-%m-%d') }}" required
				   pattern="\d{4}-\d{2}-\d{2}">
        </div>
        
        <!-- Asignar a -->
        <div class="mb-3 col-md-4">
            <label class="form-label">Asignar a*</label>
            <select class="form-select" name="asignado_a" required>
                {% for usuario in usuarios %}
                <option value="{{ usuario.id }}">
                    {{ usuario.nombre_completo }} ({{ usuario.rol }})
                </option>
                {% endfor %}
            </select>
        </div>
        
        <!-- Cliente -->
        <div class="mb-3 col-md-4">
            <label class="form-label">Cliente</label>
            <select class="form-select" name="cliente_id">
                <option value="">-- Sin cliente --</option>
                {% for cliente in clientes %}
                <option value="{{ cliente.id }}">
                    {{ cliente.nombre }} {% if cliente.empresa %}({{ cliente.empresa }}){% endif %}
                </option>
                {% endfor %}
            </select>
        </div>
		
		<!-- Adjuntar -->
		<div class="mb-3">
			<label class="form-label">游늹 Archivos de referencia</label>
			<input type="file" class="form-control" name="archivos[]" multiple>
				accept=".pdf,.doc,.docx,.psd,.ai,.jpg,.jpeg,.png,.mp4,.mov">
			<small class="text-muted">Formatos aceptados: dise침os (PSD, AI), documentos (PDF, DOC), im치genes (JPG, PNG) o videos (MP4, MOV)</small>
		</div>
        
        <!-- Botones -->
        <div class="mt-4">
            <button type="submit" class="btn btn-primary px-4">
                <i class="bi bi-save"></i> Guardar Tarea
            </button>
            <a href="{{ url_for('tareas') }}" class="btn btn-outline-secondary ms-2">
                <i class="bi bi-x-circle"></i> Cancelar
            </a>
        </div>
    </form>
</div>

<!-- Validaci칩n de formulario -->
<script>
(() => {
  'use strict'
  const forms = document.querySelectorAll('.needs-validation')
  Array.from(forms).forEach(form => {
    form.addEventListener('submit', event => {
      if (!form.checkValidity()) {
        event.preventDefault()
        event.stopPropagation()
      }
      form.classList.add('was-validated')
    }, false)
  })
})()
</script>
{% endblock %}